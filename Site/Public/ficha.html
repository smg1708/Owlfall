<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OwlFall | Ficha</title>

    <script src="./js/sessao.js"></script>
    <script src="./js/nivel.js"></script>
    <link rel="icon" href="assets/icon/coruja.jpg">

    <link rel="stylesheet" type="text/css" href="style/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kavoon&display=swap" rel="stylesheet">
</head>

<body>
   
    <div class="div-header-ficha">
        <div class="div-container-navbar-ficha">
            <div class="div-logo-navbar">
                <a href="index.html"> OwlFall </a>
            </div>
            <div class="div-navbar">
                <a href="index.html"> Sobre </a>
                <a href="poder.html"> Poder </a>
                <a onclick="if (verificarLoginAntes()) personagens()" > Personagens </a>
                <a onclick="if (verificarLoginAntes()) campanhas()" > Campanhas </a>
                <a href="login.html"> Login </a>
                <div><a class="circulo-login" onclick="if (verificarLoginAntes()) quiz()"><img src="assets/imgs/icon_sem_personagem.jpg" alt="" ></a></div>
            </div>
        </div>
        <div class="div-traco-ficha"></div>
    </div>
    <div class="div-container-body-ficha">
        <div class="box-personagem-ficha">
            <img src="assets/imgs/icon_sem_personagem.jpg" alt="" id="img_padrao_ficha">
            <input type="file" id="inp_foto_personagem" class="foto-personagem" name="foto_personagem" onchange="salvarImagem()">
            <h3>Personagem</h3> <input type="text" class="input-personagem" id="inp_personagem"> 
            <h3>Jogador</h3> <input type="text" class="input-personagem" id="inp_jogador_ficha">
        </div>
        <div class="box-personagem-ficha-dados">
                <div class="div-box-atributos-ficha">
                    <div class="div-atributos-ficha">
                        
                        <img src="assets/imgs/atributos.png" alt="" id="img-atributos-ficha">

                        <input type="number" id="inp_agilidade_ficha" value="1">
                        <input type="number" id="inp_forca_ficha" value="1">
                        <input type="number" id="inp_intelecto_ficha" value="1">
                        <input type="number" id="inp_presenca_ficha" value="1"> 
                        <input type="number" id="inp_vigor_ficha" value="1">
                    </div>
                </div>
                <div class="box-personagem-ficha-tecnica">
                    <span class="span-nivel">Nivel</span> 
                    <select id="select_nivel" onchange="mudarNivelmudarNivel()">
                        <option selected>0</option>
                        <option>1</option>
                        <option>2</option>
                        <option>3</option>
                        <option>4</option>
                        <option>5</option>
                        <option>6</option>
                        <option>7</option>
                        <option>8</option>
                        <option>9</option>
                        <option>10</option>
                        <option>11</option>
                        <option>12</option>
                        <option>13</option>
                        <option>14</option>
                        <option>15</option>
                        <option>16</option>
                        <option>17</option>
                        <option>18</option>
                        <option>19</option>
                        <option>20</option>
                    </select>
                    <h3>Classe</h3> 
                    <input type="text" class="area1 " id="inp_classe" value="Fortificador" style="font-size: 18px;">

                    <div class="div-status-ficha">
                        <h2 style="padding-left: 60px;">VIDA</h2>
                        <div class="div-barra-vida">
                            <input type="number" class="input-vida-ficha input-esquerda-vida" value="0" id="inp_vida_atual"> <span> / </span> <input type="number" class="input-vida-ficha input-direita-vida" value="0" id="inp_vida_total">
                        </div>
                        <h2 style="padding-left: 60px;">SANIDADE</h2>
                        <div class="div-barra-sanidade">
                            <input type="number" class="input-sanidade-ficha input-esquerda-sanidade" value="0" id="inp_sanidade_atual"> <span> / </span> <input type="number" class="input-sanidade-ficha input-direita-sanidade" value="0" id="inp_sanidade_total">
                        </div>
                        <h2 style="padding-left: 60px;">NEN</h2>
                        <div class="div-barra-nen">
                            <input type="number" class="input-nen-ficha input-esquerda-nen" value="0" id="inp_nen_atual"> <span> / </span> <input type="number" class="input-nen-ficha input-direita-nen" value="0" id="inp_nen_total">
                        </div>
                    </div>
                </div>
                <div class="box-personagem-ficha-pericias">
                    <h1>Pericias</h1>
                <div class="div-pericias-ficha">
                    <div class="coluna-pericias">

                        
                        <div class="box-pericia-linha">
                            <span>Adestramento</span>
                            <input type="text" class="inp-pericia-valor">
                            <select class="select-pericia" id="select_adestramento">
                                <option selected>0+</option>
                                <option>5+</option>
                                <option>10+</option>
                                <option>15+</option>
                            </select>
                        </div>

                        
                        <div class="box-pericia-linha">
                            <span>Artes</span>
                            <input type="text" class="inp-pericia-valor">
                            <select class="select-pericia" id="select_artes">
                                <option selected>0+</option>
                                <option>5+</option>
                                <option>10+</option>
                                <option>15+</option>
                            </select>
                        </div>

                        <div class="box-pericia-linha">
                            <span>Acrob/Atlet</span>
                            <input type="text" class="inp-pericia-valor">
                            <select class="select-pericia" id="select_acrob_atlet">
                                <option selected>0+</option>
                                <option>5+</option>
                                <option>10+</option>
                                <option>15+</option>
                            </select>
                        </div>

                        <div class="box-pericia-linha">
                            <span>Ciências</span>
                            <input type="text" class="inp-pericia-valor">
                            <select class="select-pericia" id="select_ciencias">
                                <option selected>0+</option>
                                <option>5+</option>
                                <option>10+</option>
                                <option>15+</option>
                            </select>
                        </div>

                        <div class="box-pericia-linha">
                            <span>Diplomacia</span>
                            <input type="text" class="inp-pericia-valor">
                            <select class="select-pericia" id="select_diplomacia">
                                <option selected>0+</option>
                                <option>5+</option>
                                <option>10+</option>
                                <option>15+</option>
                            </select>
                        </div>

                        <div class="box-pericia-linha">
                            <span>Enganação</span>
                            <input type="text" class="inp-pericia-valor">
                            <select class="select-pericia" id="select_enganacao">
                                <option selected>0+</option>
                                <option>5+</option>
                                <option>10+</option>
                                <option>15+</option>
                            </select>
                        </div>

                        <div class="box-pericia-linha">
                            <span>Fortitude</span>
                            <input type="text" class="inp-pericia-valor">
                            <select class="select-pericia" id="select_fortitude">
                                <option selected>0+</option>
                                <option>5+</option>
                                <option>10+</option>
                                <option>15+</option>
                            </select>
                        </div>

                        <div class="box-pericia-linha">
                            <span>Furtividade</span>
                            <input type="text" class="inp-pericia-valor">
                            <select class="select-pericia" id="select_furtividade">
                                <option selected>0+</option>
                                <option>5+</option>
                                <option>10+</option>
                                <option>15+</option>
                            </select>
                        </div>

                        <div class="box-pericia-linha">
                            <span>Iniciativa</span>
                            <input type="text" class="inp-pericia-valor">
                            <select class="select-pericia" id="select_iniciativa">
                                <option selected>0+</option>
                                <option>5+</option>
                                <option>10+</option>
                                <option>15+</option>
                            </select>
                        </div>

                        <div class="box-pericia-linha">
                            <span>Intimidação</span>
                            <input type="text" class="inp-pericia-valor">
                            <select class="select-pericia" id="select_intimidacao">
                                <option selected>0+</option>
                                <option>5+</option>
                                <option>10+</option>
                                <option>15+</option>
                            </select>
                        </div>

                        <div class="box-pericia-linha">
                            <span>Investigação</span>
                            <input type="text" class="inp-pericia-valor">
                            <select class="select-pericia" id="select_investigacao">
                                <option selected>0+</option>
                                <option>5+</option>
                                <option>10+</option>
                                <option>15+</option>
                            </select>
                        </div>

                        <div class="box-pericia-linha">
                            <span>Luta</span>
                            <input type="text" class="inp-pericia-valor">
                            <select class="select-pericia" id="select_luta">
                                <option selected>0+</option>
                                <option>5+</option>
                                <option>10+</option>
                                <option>15+</option>
                            </select>
                        </div>

                        <div class="box-pericia-linha">
                            <span>Medicina</span>
                            <input type="text" class="inp-pericia-valor">
                            <select class="select-pericia" id="select_medicina">
                                <option selected>0+</option>
                                <option>5+</option>
                                <option>10+</option>
                                <option>15+</option>
                            </select>
                        </div>

                        <div class="box-pericia-linha">
                            <span>Percepção</span>
                            <input type="text" class="inp-pericia-valor">
                            <select class="select-pericia" id="select_percepcao">
                                <option selected>0+</option>
                                <option>5+</option>
                                <option>10+</option>
                                <option>15+</option>
                            </select>
                        </div>

                        <div class="box-pericia-linha">
                            <span>Pilotagem</span>
                            <input type="text" class="inp-pericia-valor">
                            <select class="select-pericia" id="select_pilotagem">
                                <option selected>0+</option>
                                <option>5+</option>
                                <option>10+</option>
                                <option>15+</option>
                            </select>
                        </div>

                        <div class="box-pericia-linha">
                            <span>Pontaria</span>
                            <input type="text" class="inp-pericia-valor">
                            <select class="select-pericia" id="select_pontaria">
                                <option selected>0+</option>
                                <option>5+</option>
                                <option>10+</option>
                                <option>15+</option>
                            </select>
                        </div>

                        <div class="box-pericia-linha">
                            <span>Profissão</span>
                            <input type="text" class="inp-pericia-valor">
                            <select class="select-pericia" id="select_profissao">
                                <option selected>0+</option>
                                <option>5+</option>
                                <option>10+</option>
                                <option>15+</option>
                            </select>
                        </div>

                        <div class="box-pericia-linha">
                            <span>Reflexos</span>
                            <input type="text" class="inp-pericia-valor">
                            <select class="select-pericia" id="select_reflexos">
                                <option selected>0+</option>
                                <option>5+</option>
                                <option>10+</option>
                                <option>15+</option>
                            </select>
                        </div>

                        <div class="box-pericia-linha">
                            <span>Sobrevivencia</span>
                            <input type="text" class="inp-pericia-valor">
                            <select class="select-pericia" id="select_sobrevivencia">
                                <option selected>0+</option>
                                <option>5+</option>
                                <option>10+</option>
                                <option>15+</option>
                            </select>
                        </div>

                        <div class="box-pericia-linha">
                            <span>Espirito</span>
                            <input type="text" class="inp-pericia-valor">
                            <select class="select-pericia" id="select_espirito">
                                <option selected>0+</option>
                                <option>5+</option>
                                <option>10+</option>
                                <option>15+</option>
                            </select>
                        </div>
                        
                    </div>

                </div>
                </div>
                <div class="box-personagem-caracteristicas-ficha">
                    <div class="box-caracteristicas-abas">

                        <div class="box-botoes-ficha">
                            <button id="btn_habilidades" style="display: block;" onclick="bot_habilidades()">Habilidades</button>
                            <button id="btn_inventario" onclick="bot_inventario()">Inventário</button>
                            <button id="btn_descricao" onclick="bot_descricao()">Descrição</button>
                        </div>

                        <div class="box-abas-caracteristicas" id="aba_habilidades">
                            <h3>Nenhuma habilidade cadastrada.</h3>
                        </div>

                        <div class="box-abas-caracteristicas" id="aba_inventario">
                            <h3>Inventário vazio.</h3>
                        </div>

                        <div class="box-abas-caracteristicas" id="aba_descricao">
                            <span>Aparência</span> <br>
                            <textarea type="text" id="inp_aparencia"></textarea> <br> <br>
                            <span>Personalidade</span> <br>
                            <textarea type="text" id="inp_personalidade"></textarea> <br> <br>
                            <span>Histórico</span> <br>
                            <textarea type="text" id="inp_descricao"></textarea> <br> <br>
                            <span>Objetivo</span> <br>
                            <textarea type="text" id="inp_objetivo"></textarea> 
                        </div>

                    </div>
                </div>

        </div>
    </div>

</body>
</html>

<script>

    var idFicha = sessionStorage.ID_FICHA;
    var enviarDados = {idFicha: idFicha};

    var pericias = [{
        'adestramento': select_adestramento.value,
        'artes': select_artes.value, 
        'acrob_atlet': select_acrob_atlet.value, 
        'ciencias': select_ciencias.value, 
        'diplomacia': select_diplomacia.value, 
        'enganacao': select_enganacao.value, 
        'fortitude': select_fortitude.value, 
        'furtividade': select_furtividade.value, 
        'iniciativa': select_iniciativa.value, 
        'intimidacao': select_intimidacao.value, 
        'investigacao': select_investigacao.value, 
        'luta': select_luta.value, 
        'medicina': select_medicina.value, 
        'percepcao': select_percepcao.value, 
        'pilotagem': select_pilotagem.value, 
        'pontaria': select_pontaria.value, 
        'profissao': select_profissao.value, 
        'reflexos': select_reflexos.value, 
        'sobrevivencia': select_sobrevivencia.value, 
        'espirito': select_espirito.value
    }]

    var botaoHabilidades = btn_habilidades;
    var botaoInventario = btn_inventario;
    var botaoDescricao = btn_descricao;
    var abaHabilidades = aba_habilidades;
    var abaInventario = aba_inventario;
    var abaDescricao = aba_descricao;

    window.onload = carregarFicha;

    function personagens() {
      window.location = "personagens.html"
    }

    function campanhas() {
      window.location = "campanhas.html"
    }

    function quiz() {
      window.location = "quiz.html"
    }
    
    function carregarFicha() {

        fetch(`/ficha/buscar?idFicha=${idFicha}`, {
        })
          .then(function (resposta) {
            return resposta.json();
          })
          .then(function (dados) {
            console.log(dados);
            
            img_padrao_ficha.src = `/assets/imgsBd/${dados[0].imagem}`
            inp_personagem.value = dados[0].nome;
            inp_jogador_ficha.value = dados[0].jogador;
        
            inp_agilidade_ficha.value = dados[0].agilidade;
            inp_forca_ficha.value = dados[0].forca;
            inp_intelecto_ficha.value = dados[0].intelecto;
            inp_presenca_ficha.value = dados[0].presenca;
            inp_vigor_ficha.value = dados[0].vigor;
        
            select_nivel.value = dados[0].nivel;
            inp_classe.value = dados[0].classe;
        
            inp_vida_atual.value = dados[0].vida;
            inp_vida_total.value = dados[0].vida;
            inp_sanidade_atual.value = dados[0].sanidade;
            inp_sanidade_total.value = dados[0].sanidade;
            inp_nen_atual.value = dados[0].nen;
            inp_nen_total.value = dados[0].nen;
        
            inp_aparencia.value = dados[0].aparencia;
            inp_personalidade.value = dados[0].personalidade;
            inp_descricao.value = dados[0].historia;
            inp_objetivo.value = dados[0].objetivo;

            select_adestramento.value = dados[0].pericias[0].adestramento;
            select_artes.value = dados[0].pericias[0].artes;
            select_acrob_atlet.value = dados[0].pericias[0].atletismo_acrobacia;
            select_ciencias.value = dados[0].pericias[0].ciencias;
            select_diplomacia.value = dados[0].pericias[0].diplomacia;
            select_enganacao.value = dados[0].pericias[0].enganacao;
            select_fortitude.value = dados[0].pericias[0].fortitude;
            select_furtividade.value = dados[0].pericias[0].furtividade;
            select_iniciativa.value = dados[0].pericias[0].iniciativa;
            select_intimidacao.value = dados[0].pericias[0].intimidacao;
            select_investigacao.value = dados[0].pericias[0].investigacao;
            select_luta.value = dados[0].pericias[0].luta;
            select_medicina.value = dados[0].pericias[0].medicina;
            select_percepcao.value = dados[0].pericias[0].percepcao;
            select_pilotagem.value = dados[0].pericias[0].pilotagem;
            select_pontaria.value = dados[0].pericias[0].pontaria;
            select_profissao.value = dados[0].pericias[0].profissao;
            select_reflexos.value = dados[0].pericias[0].reflexos;
            select_sobrevivencia.value = dados[0].pericias[0].sobrevivencia;
            select_espirito.value = dados[0].pericias[0].espirito;
        });
    }

    function esconderTudo() {
        abaHabilidades.style.display = "none";
        abaInventario.style.display = "none";
        abaDescricao.style.display = "none";
    }
    
    function bot_habilidades() {
        esconderTudo();
        abaHabilidades.style.display = "block";
    }
    
    function bot_inventario() {
        esconderTudo();
        abaInventario.style.display = "block";
    }
    
    function bot_descricao() {
        esconderTudo();
        abaDescricao.style.display = "block";
    }

    function salvarImagem() {
        var foto = inp_foto_personagem
        const formData = new FormData();
        formData.append('idFicha', idFicha);
        formData.append('foto_personagem', foto.files[0])
        
        fetch("/ficha/imagem", {
            method: "PUT",
            body: formData
        })
        .then(res => {
        })
        .catch(err => {
            console.log(err);
        })
    }
    
    function atualizarFicha() {

        var dadosAtualizados = {
            idFicha: idFicha,
            nome: inp_personagem.value,
            jogador: inp_jogador_ficha.value,
            nivel: select_nivel.value,
            vida: inp_vida_atual.value,
            sanidade: inp_sanidade_atual.value,
            nen: inp_nen_atual.value,
            aparencia: inp_aparencia.value,
            personalidade: inp_personalidade.value,
            historia: inp_descricao.value,
            objetivo: inp_objetivo.value,
            
            agilidade: inp_agilidade_ficha.value,
            forca: inp_forca_ficha.value,
            intelecto: inp_intelecto_ficha.value,
            presenca: inp_presenca_ficha.value,
            vigor: inp_vigor_ficha.value,
            
            adestramento: select_adestramento.value,
            artes: select_artes.value,
            acrob_atlet: select_acrob_atlet.value,
            ciencias: select_ciencias.value,
            diplomacia: select_diplomacia.value,

            enganacao: select_enganacao.value,
            fortitude: select_fortitude.value,
            furtividade: select_furtividade.value,
            iniciativa: select_iniciativa.value,
            intimidacao: select_intimidacao.value,
            investigacao: select_investigacao.value,
            luta: select_luta.value,
            medicina: select_medicina.value,
            percepcao: select_percepcao.value,
            pilotagem: select_pilotagem.value,
            pontaria: select_pontaria.value,
            profissao: select_profissao.value,
            reflexos: select_reflexos.value,
            sobrevivencia: select_sobrevivencia.value,
            espirito: select_espirito.value
        };

        navigator.sendBeacon(
            `/ficha/atualizar?idFicha=${idFicha}`,
            new Blob([JSON.stringify({ 
                dadosPersonagemServer: dadosAtualizados 
            })], 
            { type: "application/json" })
        );
    }
                
    var vdTotalNivel = inp_vida_total.value
    var sanTotalNivel = inp_sanidade_total.value
    var nenTotalNivel = inp_nen_total.value
    var vdGanha = 0
    var sanGanha = 0
    var nenGanha = 0

</script>