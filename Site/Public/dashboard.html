<!DOCTYPE html>
<html lang="pt-br">

<head>
    <link rel="shortcut icon" href="/assets/icon/Pinguim_do_ep.ico" type="image/x-icon">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" type="text/css" href="style/style.css">

    <script src="../js/sessao.js"></script>

</head>

<body onload="obterDados()">

    <div class="janela-dash">

        <div class="header-left">

            <h1>Usuário</h1>

            <div class="hello">
                <h3>Olá, <span id="b_usuario">usuário</span>!</h3>
            </div>

            <div class="btn-nav"><a href="./personagens.html"><h3>Personagens</h3></a></div>
            <div class="btn-nav"><a href="./campanhas.html"><h3>Campanhas</h3></a></div>
            <div class="btn-nav"><a href="./poder.html"><h3>Poder</h3></a></div>
            <div class="btn-nav-white"><a href="Quiz.html"><h3>Quizes</h3></a></div>
            <div class="btn-nav-white"><a href="./dashboard.html"><h3>Dashboard</h3></a></div>
            <div class="btn-logout" onclick="limparSessao()"><h3>Sair</h3></div>

        </div>

        <div class="dash">

            <div class="kpi">
                <h3>Média de Acertos</h3>
                <span id="media_KPI">0%</span>
            </div>

            <div class="kpi">
                <h3>Personagem Mais Escolhido</h3>
                <div id="top1Personagem"></div>
            </div>

            <div class="kpi">
                <h3>Classe Mais Usada</h3>
                <div id="top1Classe"></div>
            </div>

            <div class="card-grafico">
                <h2>Gráfico de Linhas</h2>
                <div class="grafico-area">
                    <canvas id="linha"></canvas>
                </div>
            </div>

            <div class="card-grafico">
                <h2>Gráfico de Barras</h2>
                <div class="grafico-area">
                    <canvas id="bar"></canvas>
                </div>
            </div>

            <div class="card-grafico">
                <h2>Gráfico de Personagens</h2>
                <div class="grafico-area">
                    <canvas id="bar2"></canvas>
                </div>
            </div>


        </div>

    </div>

</body>

<script>
b_usuario.innerHTML = sessionStorage.NICK_USUARIO;

function obterDados() {
    fetch("/dashboard/medias")
        .then(r => r.json())
        .then(dados => {
            if(dados.length > 0){
                plotarGraficoLinha(dados);
                AtualizarKpiMedia(dados);
            }
        });

    fetch("/dashboard/personagens")
        .then(r => r.json())
        .then(dados => {
            if(dados.length > 0){
                AtualizarKpiPersonagem(dados);
            }
        });

    fetch("/dashboard/classes")
        .then(r => r.json())
        .then(dados => {
            if(dados.length > 0){
                AtualizarKpiClasse(dados);
            }
        });
}

function plotarGraficoLinha(dados) {
    let labels = ["Quiz de Conhecimento"];
    let valores = [Number(dados[0].media)];

    let ctx = document.getElementById('linha').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: "Média de acertos",
                data: valores,
                borderColor: 'rgb(75, 192, 192)',
                tension: 0.3
            }]
        }
    });
}

function AtualizarKpiMedia(dados){
    let totalQuestoes = 10;
    let media = Number(dados[0].media);
    let porcentagem = (media / totalQuestoes) * 100;
    document.getElementById('media_KPI').innerHTML = `${porcentagem.toFixed(0)}%`;
}

function AtualizarKpiPersonagem(dados){
    let div = document.getElementById('top1Personagem');
    let personagem = dados[0].personagem;
    div.innerHTML = "";

    let img = "";
    if(personagem == "Gon_Freecss") img = "assets/imgs/Gon.jpg";
    else if(personagem == "Killua_Zoldyck") img = "assets/imgs/Killua.jpg";
    else if(personagem == "Leorio") img = "assets/imgs/Leorio.jpg";
    else if(personagem == "Kurapika") img = "assets/imgs/Kurapika.jfif";

    div.innerHTML = `<img src="${img}" width="200">`;
}

function AtualizarKpiClasse(dados){
    let div = document.getElementById('top1Classe');
    let classe = dados[0].classe;
    div.innerHTML = `<h2>${classe}</h2>`;
}
</script>

</html>
